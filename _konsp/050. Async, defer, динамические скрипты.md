# 050. Async, defer, динамические скрипты

Веб страница загружается некоторое время. 
Если js-скрипт загрузится и начнёт работу раньше, чем будет построена DOM-модель, то может случиться, что скрипт попытается работать с ещё не существующими элементами.
Частично этого можно избежать с помощью:
- поместить 
  ```html
	<script src="script.js"></script>
  ```
  перед:
  ```html
  </body>
  ```
- в script.js код скрипта поместить в обёртку события "DOMContentLoaded" (когда контент загружен):
  ```javascript
  document.addEventListener('DOMContentLoaded', () => {
    // код скрипта
  });
  ```

Но если страница грузится очень долго, то такой сайт может быть мало-работоспособным. Поэтому были придуманы атрибуты:
- `defer` - инструкция браузеру загружать скрипт в фоновом режиме и одновременно загружать страницу. Скрипт начнёт выполняться только после того, как DOM-дерево будет готово но до события `DOMContentLoaded`. Поэтому эту строку можно перенести в `<head>`:
  ```html
    <script defer src="script.js"></script>
  </head>
  ```
  выполнение скриптов с тегом `defer` осуществляется в порядке обявления в html:
  ```html
  <script defer src="script.js"></script>
  <script defer src="test.js"></script>
  ```
  сначала выполнится `script.js` затем `test.js`. Даже если первый загружается дольше второго.
  > как это можно использовать: можно сначала загрузить необходимые библиотеки (например, jQuery) а потом сврипты, использующие эти библиотеки.
- `Async` - скрипты загружаются параллельно в фоне и начнут выполняться ка только будут загружены.
  ```html
  <script Async src="script.js"></script>
  <script Async src="test.js"></script>
  ```
  сначала выполнится тот скрипт, который раньше загрузится.

---

## Еще один способ загружать скрипты
```html
<script defer src="script.js"></script>
```

> script.js:
```javascript
const script = document.createElement('script');
script.src = 'test.js';
script.async = false; // скрипт будет загружен как будто он помещён в текст страницы а не асинхронно
document.body.append(script);
```
- сначала в фоне загрузится "script.js"
- затем ожидание когда будет готово DOM-дерево
- выполнение "script.js"
- загрузка и выполнение 'test.js'


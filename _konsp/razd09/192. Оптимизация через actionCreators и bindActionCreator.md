# 192. Оптимизация через actionCreators и bindActionCreator

## `bindActionCreators(actionCreators, dispatch)`

Превращает объект, значениями которого являются [создатели действий (action creators)](https://redux.js.org/understanding/thinking-in-redux/glossary#action-creator) , в объект с теми же ключами, но с каждым создателем действия (action creator), заключенным в вызов [dispatch](https://redux.js.org/api/store#dispatchaction), чтобы их можно было вызывать напрямую.

Обычно вы должны просто вызывать `dispatch` непосредственно в своём экземпляре [Store](https://redux.js.org/api/store). Если вы используете Redux с React, [react-redux](https://github.com/gaearon/react-redux) предоставит вам функцию `dispatch`, так что вы также можете вызывать ее напрямую.

Единственный вариант использования — `bindActionCreators` это когда вы хотите передать некоторые создатели действий компоненту, который не знает о Redux, и вы не хотите передавать `dispatch` или Redux `store` ему.

Для удобства вы также можете передать `создателя действия` в качестве первого аргумента и получить взамен обёрнутую функцию отправки.

**Parameters:**

1. `actionCreators`( Функция или объект ): `action creator` или объект, значения которого являются создателями действия.
2. `dispatch`( Функция ): `dispatch` функция, доступная в экземпляре `Store`.

**Returns:**

( _функция или объект_ ): объект, имитирующий исходный объект, но с каждой функцией, немедленно отправляющей действие, возвращаемое соответствующим создателем действия. Если вы передали функцию как `actionCreators`, возвращаемое значение также будет одной функцией.

**Example:**

TodoActionCreators.js

```javascript
export function addTodo(text) {
	return {
		type: 'ADD_TODO',
		text,
	};
}

export function removeTodo(id) {
	return {
		type: 'REMOVE_TODO',
		id,
	};
}
```

SomeComponent.js

```javascript
import React from 'react';
import { bindActionCreators } from 'redux';
import { connect } from 'react-redux';

import * as TodoActionCreators from './TodoActionCreators';
console.log(TodoActionCreators);
// {
//   addTodo: Function,
//   removeTodo: Function
// }

function TodoListContainer(props) {
	// Injected by react-redux:
	const { dispatch, todos } = props;

	// Вот хороший пример использования bindActionCreators:
	// Вы хотите, чтобы дочерний компонент совершенно не знал о Redux.
	// Сейчас мы создаем связанные версии этих функций, чтобы мы могли
	// передаем их нашему дочернему элементу позже.

	const boundActionCreators = useMemo(
		() => bindActionCreators(TodoActionCreators, dispatch),
		[dispatch]
	);
	console.log(boundActionCreators);
	// {
	//   addTodo: Function,
	//   removeTodo: Function
	// }

	useEffect(() => {
		// Примечание: это не сработает:
		// TodoActionCreators.addTodo('Use Redux')

		// Вы просто вызываете функцию, которая создает действие.
		// Вы также должны отправить действие!

		// Это будет работать:
		let action = TodoActionCreators.addTodo('Use Redux');
		dispatch(action);
	}, []);

	return <TodoList todos={todos} {...this.boundActionCreators} />;

	// Альтернативой bindActionCreators является
	// передача только функции отправки,
	// но тогда вашему дочернему компоненту необходимо импортировать действие.

	// return <TodoList todos={todos} dispatch={dispatch} />
}

export default connect((state) => ({ todos: state.todos }))(TodoListContainer);
```

**Советы:**

- Вы спросите: а почему бы сразу не привязать создателей действий к экземпляру хранилища, как в классическом Flux? Проблема в том, что это не будет хорошо работать с универсальными приложениями, которые должны отображаться на сервере. Скорее всего, вы хотите иметь отдельный экземпляр хранилища для каждого запроса, чтобы вы могли подготовить их с разными данными, но привязка создателей действий во время их определения означает, что вы застряли с одним экземпляром хранилища для всех запросов.

- Если вы используете ES5, вместо `import \* as` синтаксиса вы можете просто передать `require('./TodoActionCreators')` его `bindActionCreators` в качестве первого аргумента. Единственное, что его волнует, это то, что значения свойств `actionCreators` являются функциями. Модульная система не имеет значения.

---

actions.js:

```javascript
export const inc = () => ({ type: 'INC' });
export const dec = () => ({ type: 'DEC' });
export const rnd = (value) => ({ type: 'RND', payload: value });
```

reducer.js:

```javascript
const initialState = { value: 0 };

const reducer = (state = initialState, action) => {
	// негласное правило: `action.type` писать `БОЛЬШИМИ БУКВАМИ`
	switch (action.type) {
		case 'INC':
			return { ...state, value: state.value + 1 };
		case 'DEC':
			return { ...state, value: state.value - 1 };
		case 'RND':
			/* так делать нельзя так как изменяется логика работы редюсера
			return Math.floor(Math.random() * 20 - 10);
			*/
			return { ...state, value: state.value + action.payload };

		default:
			return state;
	}
};

export default reducer;
```

index.js:

```javascript
import { createStore, bindActionCreators } from 'redux';

import reducer from './reducer';
import * as actions from './actions';

console.log('actions =', actions);
// actions = Module {__esModule: true, Symbol(Symbol.toStringTag): 'Module'}
// 	dec: (…)
// 	inc: (…)
// 	rnd: (…)
// 	__esModule: true
// 	Symbol(Symbol.toStringTag): "Module"
// 	get dec: () => (/* binding */ dec)
// 	get inc: () => (/* binding */ inc)
// 	get rnd: () => (/* binding */ rnd)
// 	[[Prototype]]: Object

const store = createStore(reducer);
const { dispatch, getState } = store;
// const { subscribe } = store;

/* именно так работает встроенная в Redux функция bindActionCreators
const bindActionCreators = (creator, dispatch) => {
	return (...args) => dispatch(creator(...args));
};
*/
const { inc, dec, rnd } = bindActionCreators(actions, dispatch);

const update = () => {
	document.getElementById('counter').textContent = getState().value;
	console.log(store.getState().value);
};

store.subscribe(update);

document.getElementById('inc').addEventListener('click', inc);
document.getElementById('dec').addEventListener('click', dec);
document.getElementById('rnd').addEventListener('click', () => {
	const value = Math.floor(Math.random() * 100 - 50);
	rnd(value);
});
```

---

## Ссылки

- bindActionCreators
  - https://redux.js.org/api/bindactioncreators
- final_code.zip
  - https://drive.google.com/file/d/1TivipgLVR0v8xE1wtY2y4DC0wW-mk9gG/view

# 211. Про разные структуры проектов и закрепление материала

## [Структура папок React за 5 шагов [2022]][4]

11 АПРЕЛЯ 2022 Г.
РОБИН ВИРУХ

Как структурировать большие приложения React по папкам и файлам — очень спорная тема. Некоторое время мне было трудно писать на эту тему, потому что не существует правильного способа сделать это.

После внедрения приложений React в течение нескольких лет я хочу рассказать вам, как я подхожу к этому вопросу для своих личных проектов, для своих внештатных проектов и для своих семинаров по React.

## **ОДИН ФАЙЛ REACT**

Первый шаг следует правилу: один файл, чтобы управлять всеми. Большинство проектов React начинаются с папки `src/` и одного файла `src/App.js` с компонентом `App`. По крайней мере, это то, что вы получаете, когда используете `create-react-app` . Это функциональный компонент , который просто отображает JSX:

```js
import * as React from 'react';

const App = () => {
	const title = 'React';

	return (
		<div>
			<h1>Hello {title}</h1>
		</div>
	);
};

export default App;
```

Со временем этот компонент добавляет больше функций, он естественным образом увеличивается в размерах, и его части необходимо извлекать как автономные компоненты React. Здесь мы извлекаем компонент списка React с другим дочерним компонентом из компонента приложения:

```js
import * as React from 'react';

const list = [
	{
		id: 'a',
		firstname: 'Robin',
		lastname: 'Wieruch',
		year: 1988,
	},
	{
		id: 'b',
		firstname: 'Dave',
		lastname: 'Davidds',
		year: 1990,
	},
];

const App = () => <List list={list} />;

const List = ({ list }) => (
	<ul>
		{list.map((item) => (
			<ListItem key={item.id} item={item} />
		))}
	</ul>
);

const ListItem = ({ item }) => (
	<li>
		<div>{item.id}</div>
		<div>{item.firstname}</div>
		<div>{item.lastname}</div>
		<div>{item.year}</div>
	</li>
);
```

Всякий раз, когда вы начинаете работу над новым проектом React, я говорю людям, что иметь несколько компонентов в одном файле — это нормально. Это допустимо даже в более крупном приложении React, когда один компонент строго привязан к другому. Однако в этом сценарии в конечном итоге одного этого файла будет недостаточно для вашего проекта React. Вот тогда мы переходим ко второму шагу.

## **НЕСКОЛЬКО ФАЙЛОВ REACT**

Второй шаг следует правилу: несколько файлов для управления ими всеми. Возьмем, к примеру, наш предыдущий компонент App с его компонентами `List` и `ListItem`: вместо того, чтобы хранить все в одном файле `src/App.js` , мы можем разделить эти компоненты на несколько файлов. Вы сами решаете, как далеко вы хотите зайти здесь. Например, я бы использовал следующую структуру папок:

```
- src/
--- App.js
--- List.js
```

Если вы пойдете еще дальше, вы также можете извлечь компонент `ListItem` в отдельный файл и позволить компоненту `List` импортировать компонент `ListItem`:

```
- src/
--- App.js
--- List.js
--- ListItem.js
```

Однако, как было сказано ранее, это может зайти слишком далеко, поскольку на данный момент компонент `ListItem` тесно связан с компонентом `List`, и поэтому было бы нормально оставить его в файле `src/ List.js` . Я следую практическому правилу: всякий раз, когда компонент React становится повторно используемым компонентом React , я разделяю его как отдельный файл, как мы сделали с компонентом `List`, чтобы сделать его доступным для других компонентов React.

## **ОТ ФАЙЛОВ REACT К ПАПКАМ REACT**

С этого момента все становится более интересным, но и более самоуверенным. Каждый компонент React со временем становится сложнее. Не только потому, что добавляется больше логики (например, больше JSX с условным рендерингом или логики с React Hooks и обработчиками событий ), но и потому, что появляется больше технических проблем, таких как стили и тесты. Наивным подходом было бы добавить больше файлов рядом с каждым компонентом React. Например, предположим, что у каждого компонента React есть тест и файл стиля:

```
- src/
--- App.js
--- App.test.js
--- App.css
--- List.js
--- List.test.js
--- List.css
```

Уже сейчас видно, что это плохо масштабируется, потому что с каждым дополнительным компонентом в папке src/ мы теряем из виду каждый отдельный компонент. Вот почему мне нравится иметь одну папку для каждого компонента React:

```
- src/
--- App/
----- index.js
----- component.js
----- test.js
----- style.css
--- List/
----- index.js
----- component.js
----- test.js
----- style.css
```

вы можете пойти еще дальше, предоставив компоненту собственную вложенную папку со всеми другими техническими проблемами, такими как тесты и стили:

```
- src/
--- App/
----- index.js
----- component.js
----- test.js
----- style.css
--- List/
----- index.js
----- component.js
----- test.js
----- style.css
----- ListItem/
------- index.js
------- component.js
------- test.js
------- style.css
```

> Важно: с этого момента вам нужно быть осторожным и не вкладывать компоненты слишком глубоко друг в друга. Мое практическое правило заключается в том, что я никогда не вставляю компоненты более чем на два уровня, поэтому папки `List` и `ListItem` в их нынешнем виде будут в порядке, но в папке `ListItem` не должно быть другой вложенной папки.

В конце концов, если вы не выходите за рамки проектов React среднего размера, на мой взгляд, это лучший способ структурировать ваши компоненты React. По моему опыту фрилансера React, многие проекты React следуют этой организации приложения React.

## **ТЕХНИЧЕСКИЕ ПАПКИ**

Следующий шаг поможет вам структурировать приложения React среднего и большого размера. Он отделяет компоненты React от повторно используемых утилит React, таких как перехватчики и контекст, а также от утилит, связанных с React, таких как вспомогательные функции (здесь Services/ ). В качестве примера возьмем следующую базовую структуру папок:

```
- src/
--- components/
----- App/
------- index.js
------- component.js
------- test.js
------- style.css
----- List/
------- index.js
------- component.js
------- test.js
------- style.css
```

Все предыдущие компоненты React были сгруппированы в новую папку `Components/` . Это дает нам еще один вертикальный уровень для создания папок для других технических категорий. Например, в какой-то момент у вас могут появиться многоразовые хуки React, которые могут использоваться более чем одним компонентом. Таким образом, вместо того, чтобы тесно привязывать собственный хук к компоненту, вы можете поместить его реализацию в специальную папку, которая может использоваться всеми компонентами React:

```
- src/
--- components/
----- App/
------- index.js
------- component.js
------- test.js
------- style.css
----- List/
------- index.js
------- component.js
------- test.js
------- style.css
--- hooks/
----- useClickOutside.js
----- useScrollDetect.js
```

Однако это не означает, что все хуки должны оказаться в этой папке. Хуки React, которые по-прежнему используются только одним компонентом, должны оставаться в файле компонента или файле `hooks.js` рядом с компонентом в папке компонента. Только многоразовые перехватчики попадают в новую папку `hooks/` . Если для одного хука требуется больше файлов, вы можете снова превратить его в папку:

```
- src/
--- components/
----- App/
------- index.js
------- component.js
------- test.js
------- style.css
----- List/
------- index.js
------- component.js
------- test.js
------- style.css
--- hooks/
----- useClickOutside/
------- index.js
------- hook.js
------- test.js
----- useScrollDetect/
------- index.js
------- hook.js
------- test.js
```

Та же стратегия может применяться, если вы используете React Context в своем проекте React. Поскольку контекст необходимо где-то создать, лучше всего создать для него специальную папку/файл, поскольку в конечном итоге он должен быть доступен многим компонентам React:

```
// здесь предыдущее дерево
--- context/
----- Session.js
```

Отсюда могут быть другие утилиты, которые должны быть доступны из вашей папки `Components/` , а также из других новых папок, таких как `Hooks/` и `context/` . Для разных утилит я обычно создаю папку `Services/` . Имя зависит от вас (например, `utils/` — это еще одно имя папки, которое я вижу довольно часто, но `Services` имеют больше смысла для следующей стратегии импорта). Но опять же, такое техническое разделение обусловлено принципом предоставления логики доступной для другого кода в нашем проекте:

```
// здесь предыдущее дерево
--- services/
----- ErrorTracking/
------- index.js
------- service.js
------- test.js
----- Format/
------- Date/
--------- index.js
--------- service.js
--------- test.js
------- Currency/
--------- index.js
--------- service.js
--------- test.js
```

Возьмем, к примеру, файл `Date/index.js` . Детали реализации могут выглядеть следующим образом:

```js
export const formatDateTime = (date) =>
	new Intl.DateTimeFormat('en-US', {
		year: 'numeric',
		month: 'numeric',
		day: 'numeric',
		hour: 'numeric',
		minute: 'numeric',
		second: 'numeric',
		hour12: false,
	}).format(date);

export const formatMonth = (date) =>
	new Intl.DateTimeFormat('en-US', {
		month: 'long',
	}).format(date);
```

## **ПАПКИ ФУНКЦИЙ**

Последний шаг поможет вам структурировать большие приложения React, поскольку он отделяет компоненты, связанные с конкретными функциями, от общих компонентов пользовательского интерфейса. Хотя первые часто используются в проекте React только один раз, вторые представляют собой компоненты пользовательского интерфейса, которые используются более чем одним компонентом.

Здесь я сосредоточусь на компонентах, чтобы пример был небольшим, однако те же знания можно применить и к другим техническим папкам из предыдущего раздела. В качестве примера возьмем следующую структуру папок, которая, возможно, не отражает всего масштаба проблемы, но я надеюсь, что вы поняли суть:

```
- src/
--- components/
----- App/
----- List/
----- Input/
----- Button/
----- Checkbox/
----- Radio/
----- Dropdown/
----- Profile/
----- Avatar/
----- MessageItem/
----- MessageList/
----- PaymentForm/
----- PaymentWizard/
----- ErrorMessage/
----- ErrorBoundary/
```

> Суть: в конечном итоге в ваших компонентах будет слишком много компонентов . Хотя некоторые из них можно использовать повторно (например, `Button`), другие больше связаны с функциями (например, `Message`).

Отсюда я бы использовал папку `Components/` только для повторно используемых компонентов (например, компонентов пользовательского интерфейса). Все остальные компоненты должны быть перемещены в соответствующую папку функций. Названия папок опять же на ваше усмотрение:

```
- src/
--- feature/
----- User/
------- Profile/
------- Avatar/
----- Message/
------- MessageItem/
------- MessageList/
----- Payment/
------- PaymentForm/
------- PaymentWizard/
----- Error/
------- ErrorMessage/
------- ErrorBoundary/
--- components/
----- App/
----- List/
----- Input/
----- Button/
----- Checkbox/
----- Radio/
----- Dropdown/
```

Если одному из компонентов функции (например, `MessageItem`, `PaymentForm`) требуется доступ к общему компоненту `Checkbox` , `Radio` или `Dropdown` , он импортирует его из папки повторно используемых компонентов пользовательского интерфейса. Если компоненту `MessageList`, специфичному для домена, требуется абстрактный компонент `List`, он также импортирует его.

Кроме того, если служба из предыдущего раздела тесно связана с функцией, переместите службу в папку конкретной функции. То же самое может относиться и к другим папкам, которые ранее были разделены по техническим причинам:

```
- src/
--- feature/
----- User/
------- Profile/
------- Avatar/
----- Message/
------- MessageItem/
------- MessageList/
----- Payment/
------- PaymentForm/
------- PaymentWizard/
------- services/
--------- Currency/
----------- index.js
----------- service.js
----------- test.js
----- Error/
------- ErrorMessage/
------- ErrorBoundary/
------- services/
--------- ErrorTracking/
----------- index.js
----------- service.js
----------- test.js
--- components/
--- hooks/
--- context/
--- services/
----- Format/
------- Date/
--------- index.js
--------- service.js
--------- test.js
```

Должна ли быть промежуточная папка `Services/` в каждой папке функций, зависит от вас. Вы также можете оставить папку и поместить папку `ErrorTracking/` непосредственно в `Error/` . Однако это может сбивать с толку, поскольку `ErrorTracking` следует каким-то образом помечать как услугу, а не как компонент React.

Здесь есть много места для вашего индивидуального подхода. В конце концов, этот шаг заключается всего лишь в объединении функций, что позволяет командам вашей компании работать над конкретными функциями, не затрагивая файлы по всему проекту.

---

---

## БОНУС: СОГЛАШЕНИЯ ОБ ИМЕНАХ ПАПОК/ФАЙЛОВ.

До того, как у нас появились библиотеки пользовательского интерфейса на основе компонентов, такие как React.js, мы привыкли называть все наши папки и файлы в соответствии с соглашением об именовании в `kebab-case`. В мире `Node.js` это по-прежнему соглашение об именах. Однако во внешнем интерфейсе с библиотеками пользовательского интерфейса на основе компонентов это соглашение об именах изменилось на `PascalCase` для папок/файлов, содержащих компоненты, поскольку при объявлении компонента оно также соответствует соглашению об именах `PascalCase`.

```
- src/
--- feature/
----- user/
------- profile/
------- avatar/
----- message/
------- message-item/
------- message-list/
----- payment/
------- payment-form/
------- payment-wizard/
----- error/
------- error-message/
------- error-boundary/
--- components/
----- app/
----- list/
----- input/
----- button/
----- checkbox/
----- radio/
----- dropdown/
```

Как и в приведенном выше примере, в идеальном мире мы бы использовали соглашение об именах в стиле [kebab-case для всех папок и файлов](https://www.robinwieruch.de/javascript-naming-conventions/), поскольку папки/файлы с именами `PascalCase` обрабатываются по-разному в разных операционных системах, что может привести к ошибкам при работе с ними. команды, использующие разные ОС.

---

## БОНУС: СТРУКТУРА ПРОЕКТА NEXT.JS

Проект `Next.js` начинается с папки `pages/` . Здесь часто возникает вопрос: куда поместить папку `src/` ?

```
- api/
- pages/
- src/
--- feature/
--- components/
```

Обычно исходная папка создается рядом с папкой страниц. Отсюда вы можете следовать ранее обсуждавшейся структуре папок/файлов в папке `src/` . Я слышал об аварийном люке в `Next.js`, где вы также можете поместить папку `Pages/` в папку `src/`

```
- api/
- src/
--- pages/
--- feature/
--- components/
```

Однако в этом случае больше нельзя иметь `/pages/` папку.

---

> Надеюсь, что все это написано, это поможет тому или иному человеку или команде структурировать свой проект React. **_Имейте в виду, что ни один из показанных подходов не является незыблемым._** Напротив, я призываю вас применить к этому свой личный подход. Поскольку каждый проект React со временем увеличивается в размерах, большинство структур папок также развиваются естественным образом. Отсюда и пятиэтапный процесс, который даст вам некоторые рекомендации, если ситуация выйдет из-под контроля.

---

## пример структуры [redux-essentials-example][3]

(https://codesandbox.io/s/github/reduxjs/redux-essentials-example-app/tree/checkpoint-4-entitySlices)

```
public/
-- favicon.ico
-- index.html
-- logo192.png
-- logo512.png
-- manifest.json
-- mockServiceWorker.js
-- primitiveui.css
-- robots.txt
src/
-- api/
-- -- client.js
-- -- server.js
-- app/
-- -- Navbar.js
-- -- store.js
-- components/
-- -- Spinner.js
-- features/
-- -- notifications
-- -- NotificationsList.js
-- -- notificationsSlice.js
-- posts/
-- -- AddPostForm.js
-- -- EditPostForm.js
-- -- PostAuthor.js
-- -- PostsList.js
-- -- ReactionButtons.js
-- -- SinglePostPage.js
-- -- TimeAgo.js
-- -- postsSlice.js
-- users/
-- -- UserPage.js
-- -- UsersList.js
-- -- usersSlice.js
-- App.js
-- index.css
-- index.js
-- setupTests.js
.gitignore
README.md
package.json
prettier.config.js
```

---

## Ссылки

- [Готовый TODO-list][1]

[1]: https://codesandbox.io/s/github/reduxjs/redux-fundamentals-example-app/tree/tutorial-steps?file=/src/features/todos/todosSlice.js

- [Туториалы][2]

[2]: https://redux.js.org/tutorials/fundamentals/part-1-overview

- [Второе приложение][3]

[3]: https://codesandbox.io/s/github/reduxjs/redux-essentials-example-app/tree/checkpoint-4-entitySlices

- [Статья про формирование структуры папок проекта][4]

[4]: https://www.robinwieruch.de/react-folder-structure/
